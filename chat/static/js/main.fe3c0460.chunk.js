(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{145:function(e){e.exports=JSON.parse('{"name":"Rnchat","displayName":"Rnchat","senderID":"594331487245","connectyCubeConfig":[{"appId":3740,"authKey":"ctJ5hKcmsp9KurE","authSecret":"Qw7RXRM49cHjGcr"},{"chat":{"streamManagement":{"enable":true}},"debug":{"mode":1}}]}')},195:function(e,t){},214:function(e,t){},216:function(e,t){},239:function(e,t){},241:function(e,t){},250:function(e,t){},252:function(e,t){},286:function(e,t){},287:function(e,t){},289:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=289},320:function(e,t,a){},321:function(e,t,a){},323:function(e,t,a){},333:function(e,t,a){},354:function(e,t,a){},355:function(e,t,a){},356:function(e,t,a){},357:function(e,t,a){},358:function(e,t,a){},359:function(e,t,a){},360:function(e,t,a){},361:function(e,t,a){},362:function(e,t,a){},363:function(e,t,a){},364:function(e,t,a){},365:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(56),i=a.n(s),o=a(1),c=a.n(o),l=a(10),u=a(2),d=a(6),h=a(13),m=a(12),g=a(41),p=a(34),f=a(42),v=a(8),y=a.n(v);function E(e){return e?y.a.storage.privateUrl(e):null}var _=function(){function e(t){Object(u.a)(this,e),this.id=t._id||t.id,this.type=t.type,this.xmpp_room_jid=t.xmpp_room_jid,this.xmpp_type=3===t.type?"chat":t.type?"groupchat":"",this.name=t.name,this.photo=e.getAvatarUrl(t.photo),this.description=t.description,this.destination=t.xmpp_room_jid||t.room_jid,this.user_id=t.user_id,this.admins_ids=t.admins_ids,this.occupants_ids=t.occupants_ids,this.updated_date=Date.parse(t.updated_at)||Date.now(),this.last_message_date_sent=t.last_message_date_sent||Date.parse(t.updated_at)/1e3||Date.parse(t.created_at)/1e3,this.last_message=t.last_message||"",this.last_message_id=t.last_message_id,this.last_message_user_id=t.last_message_user_id,this.unread_messages_count=t.unread_messages_count,this.unread_messages_ids=t.unread_messages_ids,this.pinned_messages_ids=t.pinned_messages_ids}return Object(d.a)(e,null,[{key:"getAvatarUrl",value:function(e){return E(e)}}]),e}(),b="FETCH_DIALOGS",w="ADD_DIALOG",S="SORT_DIALOGS",O="UPDATE_DIALOG",k="DELETE_DIALOG",j=function(e){return{type:b,dialogs:e}},x=function(e){return{type:O,dialog:e}},U=function(e){return{type:w,dialog:e}},C=function(e,t){return{type:S,message:e,count:t}},D="FETCH_MESSAGES",I="PUSH_MESSAGE",N="DELETE_ALL_MESSAGES",M="LAZY_FETCH_MESSAGES",L="UPDATE_MESSAGES",R=function(e,t,a){return{type:L,dialogId:e,msgId:t,msg:a}},A=function(e,t){return{type:I,message:e,dialogId:t}},P="SELECTED_DIALOG",T="UN_SELECTED_DIALOG",F="FETCH_USERS",z=function(e){return{type:F,users:e}},W=a(48),B=a(15),H="SET_CURRENT_USER",G="RESET_CURRENT_USER",q="UPDATE_CURRENT_USER",J=function(e){return{type:H,currentUser:e}},Y=a(35),K=a(37),Z=function(e,t){var a=t.map((function(t){return t.id===e.dialog.id?Object.assign(t,e.dialog):t}));return Object(Y.a)(a)},V=function(e,t){var a=e.history.reverse().concat(t[e.dialogId]);return Object(B.a)(Object(B.a)({},{}),{},Object(K.a)({},e.dialogId,a))},Q=function(e,t){var a=e.message,n=e.count,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.sort((function(e,a){var n=new Date(1e3*a.last_message_date_sent)-new Date(1e3*e.last_message_date_sent);return t?!n:n}))}(t.map((function(e){if(e.id===a.dialog_id){var t={last_message:a.body,last_message_date_sent:a.date_sent,updated_date:a.date_sent,unread_messages_count:n?e.unread_messages_count+=1:e.unread_messages_count};return Object.assign(e,t)}return e})));return Object(Y.a)(r)},X=function(e,t){if(0===Object.keys(t).length)return t;var a=t[e.dialogId].map((function(t,a){if(t.id===e.msgId){var n=Object(B.a)({},t);return n.send_state=e.msg.send_state,Object(B.a)({},n)}return t}));return Object(B.a)(Object(B.a)({},t),{},Object(K.a)({},e.dialogId,a))},$=function(e,t){var a={};return e.forEach((function(e){a[e.id]=e})),Object(B.a)(Object(B.a)({},t),a)},ee=Object(W.b)({currentUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case H:return t.currentUser;case q:var a=Object.assign(e.user,t.currentUser);return e.user=a,Object(B.a)({},e);case G:return null;default:return e}},dialogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return t.dialogs;case O:var a=Z(t,e);return a;case w:return[t.dialog].concat(Object(Y.a)(e));case S:var n=Q(t,e);return n;case k:var r=e.filter((function(e){return e.id!==t.dialogId}));return r;default:return e}},selectedDialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return Object(B.a)({},t.dialog);case T:return{};default:return e}},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:var a=t.history;return Object(B.a)(Object(B.a)({},e),{},Object(K.a)({},t.dialogId,a.reverse()));case M:var n=V(t,e);return n;case L:var r=X(t,e);return r;case I:return Object(B.a)(Object(B.a)({},e),{},Object(K.a)({},t.dialogId,[].concat(Object(Y.a)(e[t.dialogId]||[]),[t.message])));case N:return Object(B.a)(Object(B.a)({},e),{},Object(K.a)({},t.dialogId,[]));default:return e}},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return $(t.users,e);default:return e}}}),te=function(e,t){return"RESSET_STORE"===t.type&&(e={}),ee(e,t)},ae=Object(W.c)(te),ne="create",re={id:"",body:"",dialog_id:"",date_sent:Math.floor(Date.now()/1e3),attachments:null,sender_id:null,sender:null},se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,a=arguments.length>1?arguments[1]:void 0;Object(u.a)(this,e),this.id=t.id||t._id,this.body=t.body||t.message,this.group_chat_alert_type=t.group_chat_alert_type||null,this.dialog_id=t.chat_dialog_id||t.extension&&t.extension.dialog_id,this.date_sent=t.date_sent||t.extension&&t.extension.date_sent||Math.floor(Date.now()/1e3),this.send_state=e.getSendState(t,a),this.attachment=e.getAttachment(t),this.sender_id=t.sender_id||t.extension&&t.extension.sender_id,this.sender=t.sender_id}return Object(d.a)(e,null,[{key:"getAttachment",value:function(e){var t;if(e.attachments&&e.attachments.length>0){var a=Object(B.a)({},e.attachments[0]),n=E(e.attachments[0].uid);return a.url=n,[a]}if((null===e||void 0===e||null===(t=e.extension)||void 0===t?void 0:t.attachments)&&e.extension.attachments.length>0){var r=Object(B.a)({},e.extension.attachments[0]),s=E(e.extension.attachments[0].uid);return r.url=s,[r]}return null}},{key:"getSendState",value:function(e,t){var a,n;return(null===e||void 0===e||null===(a=e.read_ids)||void 0===a?void 0:a.find((function(e){return e!==t})))?3:(null===e||void 0===e||null===(n=e.delivered_ids)||void 0===n?void 0:n.find((function(e){return e.delivered_ids!==t})))?2:0}}]),e}(),ie=function e(t){Object(u.a)(this,e),this.attachment=t.extension.attachments,this.body=t.body,this.date_sent=t.extension.date_sent,this.dialog_id=t.extension.dialog_id,this.id=t.id,this.send_state=0,this.sender=void 0,this.sender_id=t.extension.sender_id},oe=function(){function e(t){Object(u.a)(this,e),this.id=t.id,this.avatar=e.getAvatarUrl(t.avatar),this.login=t.login,this.custom_data=t.custom_data?t.custom_data:"",this.full_name=t.full_name||t.login,this.phone=t.phone,this.created_at=t.created_at,this.updated_at=t.updated_at,this.last_request_at=t.last_request_at}return Object(d.a)(e,null,[{key:"getAvatarUrl",value:function(e){return E(e)}}]),e}(),ce=3,le=2,ue=new(function(){function e(){var t=this;Object(u.a)(this,e),this.getMoreMessages=function(){var e=Object(l.a)(c.a.mark((function e(a){var n,r,s,i,o,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getMessagesByDialogId(a.id),r=n[0],s=Object.assign(a,{last_messages_for_fetch:r.date_sent}),i={chat_dialog_id:a.id,date_sent:{lt:r.date_sent},sort_desc:"date_sent"},e.next=6,y.a.chat.message.list(i);case 6:return o=e.sent,l=[],o.items.forEach((function(e){e.group_chat_alert_type||l.push(new se(e,t.currentUser.id))})),ae.dispatch(x(s)),u=ae.dispatch((c=a.id,{type:M,dialogId:c,history:l})),e.abrupt("return",u.history.length);case 12:case"end":return e.stop()}var c}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendMsgChatAlertOnCreate=function(){var e=Object(l.a)(c.a.mark((function e(a,n,r){var s,i,o,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=Math.floor(Date.now()/1e3),i=a.type===ce?a.occupants_ids.find((function(e){return e!=t.currentUser.id})):a.xmpp_room_jid,o={date_sent:s,save_to_history:1,dialog_id:a.id,group_chat_alert_type:r,sender_id:t.currentUser.id},l={type:a.xmpp_room_jid?"groupchat":"chat",body:n,extension:o},y.a.chat.send(i,l);case 5:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.updateDialogsUnreadMessagesCount=function(e){var t=Object.assign(e,{unread_messages_count:0});return ae.dispatch(x(t)),!0}}return Object(d.a)(e,[{key:"setUpListeners",value:function(){y.a.chat.onMessageListener=this.onMessageListener.bind(this),y.a.chat.onSentMessageCallback=this.onSentMessageListener.bind(this),y.a.chat.onDeliveredStatusListener=this.onDeliveredStatus.bind(this),y.a.chat.onReadStatusListener=this.onReadStatus.bind(this)}},{key:"fetchDialogsFromServer",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,n,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===ae.getState().dialogs.length){e.next=2;break}return e.abrupt("return",ae.getState().dialogs);case 2:return e.next=4,y.a.chat.dialog.list();case 4:if(t=e.sent,a=this.currentUser,n=[],r=t.items.map((function(e){return e.type===ce&&e.occupants_ids.forEach((function(e){e!==a.id&&n.push(e)})),new _(e)})),0===n.length){e.next=13;break}return e.next=11,this.getUsersList(n);case 11:s=e.sent,ae.dispatch(z(s));case 13:return ae.dispatch(j(r)),e.abrupt("return",ae.getState().dialogs);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMessages",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,i,o,l,u=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.getMessagesByDialogId(t.id),n=null,!(!t.isAlreadyMessageFetch||t.unread_messages_count>0&&!t.isAlreadyMessageFetch)){e.next=14;break}return e.next=5,y.a.chat.message.list({chat_dialog_id:t.id,sort_desc:"date_sent"});case 5:r=e.sent,s=[],r.items.forEach((function(e){e.group_chat_alert_type||s.push(new se(e,u.currentUser.id))})),i=Object.assign(t,{isAlreadyMessageFetch:!0}),this.updateDialogsUnreadMessagesCount(i),ae.dispatch((c=t.id,{type:D,dialogId:c,history:s})),n=s.length,e.next=22;break;case 14:if(!(t.unread_messages_count>0)){e.next=21;break}return o=this.getMessagesByDialogId(t.id),l=o[t.unread_messages_count-1],this.readAllMessages(t.id),e.next=20,this.sendReadStatus(l.id,l.sender_id,l.dialog_id);case 20:this.updateDialogsUnreadMessagesCount(t);case 21:n=a.length;case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}var c}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){var n,r,s,i,o,l,u,d,h,m=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.length>2&&void 0!==m[2]&&m[2],r=m.length>3?m[3]:void 0,s=this.currentUser,i=a.trim(),o=Math.floor(Date.now()/1e3),l=t.type===ce?t.occupants_ids.find((function(e){return e!=s.id})):t.xmpp_room_jid,(u={type:t.xmpp_type,body:i,extension:{save_to_history:1,dialog_id:t.id,sender_id:s.id,date_sent:o}}).id=this.messageUniqueId,!n){e.next=10;break}return e.abrupt("return",this.sendMessageAsAttachment(t,l,u,n,r));case 10:return d=new ie(u),h=Object.freeze(d),e.next=14,ae.dispatch(A(h,t.id));case 14:r(),y.a.chat.send(l,u),ae.dispatch(C(h));case 17:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"sendChatAlertOnCreate",value:function(e){this.sendMsgChatAlertOnCreate(e,"Group is created",ne)}},{key:"sendMessageAsAttachment",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a,n,r,s){var i,o,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=URL.createObjectURL(r.file),n.extension.attachments=[{url:i}],n.body="Image attachment",o=new ie(n),e.next=6,ae.dispatch(A(o,t.id));case 6:return s(),e.next=9,this.uploadPhoto(r);case 9:return l=e.sent,u={size:(c=l).size,uid:c.uid,type:c.content_type,name:c.name,width:400,height:400},n.extension.attachments=[u],e.next=14,y.a.chat.send(a,n);case 14:return ae.dispatch(C(o)),e.abrupt("return");case 16:case"end":return e.stop()}var c}),e,this)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()},{key:"createPrivateDialog",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,i,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=ae.getState().dialogs,n=null,a.forEach((function(e){e.type===ce&&e.occupants_ids.find((function(e){return e===t}))&&(n=e)})),n){e.next=21;break}return r={type:ce,occupants_ids:t},e.next=7,y.a.chat.dialog.create(r);case 7:if(s=e.sent,n=new _(s),!this.getUserFromReduxById(t)){e.next=14;break}return ae.dispatch(U(n)),e.abrupt("return",n);case 14:return e.next=16,this.getUserFromServerById(t);case 16:return(i=e.sent).user=new oe(i.user),ae.dispatch(z([i.user])),ae.dispatch(U(n)),e.abrupt("return",n);case 21:if(!this.getUserFromReduxById(t)){e.next=25;break}return e.abrupt("return",n);case 25:return e.next=27,this.getUserFromServerById(t);case 27:return(o=e.sent).user=new oe(o.user),ae.dispatch(z([o.user])),e.abrupt("return",n);case 31:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createPublicDialog",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a,n){var r,s,i,o,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.currentUser,t.unshift(r.id),s={type:le,occupants_ids:t,name:a},!n){e.next=9;break}return e.next=6,this.uploadPhoto(n);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=null;case 10:return(i=e.t0)&&(s.photo=i.uid),e.next=14,y.a.chat.dialog.create(s);case 14:return o=e.sent,l=new _(o),ae.dispatch(U(l)),e.abrupt("return",l);case 18:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"readAllMessages",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.a.chat.message.update(null,{chat_dialog_id:t,read:1}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"readMessage",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.onReadStatus(t,a),e.abrupt("return",y.a.chat.message.update(null,{chat_dialog_id:a,read:1}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onMessageListener",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){var n,r,s,i,o,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new se(a),s=this.currentUser,i=null===(n=this.getSelectedDialog())||void 0===n?void 0:n.id,!a.extension.group_chat_alert_type){e.next=10;break}return e.next=6,y.a.chat.dialog.list();case 6:return o=e.sent,l=o.items.map((function(e){return new _(e)})),ae.dispatch(j(l)),e.abrupt("return");case 10:t!==s.id&&(i===r.dialog_id?(ae.dispatch(C(r)),this.readMessage(r.id,r.dialog_id),this.sendReadStatus(a.extension.message_id,a.extension.sender_id,a.dialog_id)):(this.sendDeliveredStatus(a.extension.message_id,a.extension.sender_id,a.dialog_id),ae.dispatch(C(r,!0))),ae.dispatch(A(r,r.dialog_id)));case 11:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onSentMessageListener",value:function(e,t){console.warn("onSentMessageListener"),e||t.extension.group_chat_alert_type||ae.dispatch(R(t.extension.dialog_id,t.id,{send_state:1}))}},{key:"onDeliveredStatus",value:function(e,t,a){console.warn("onDeliveredStatus",e),ae.dispatch(R(t,e,{send_state:2}))}},{key:"onReadStatus",value:function(e,t,a){console.warn("onReadStatus",e),ae.dispatch(R(t,e,{send_state:3}))}},{key:"sendReadStatus",value:function(e,t,a){y.a.chat.sendReadStatus({messageId:e,userId:t,dialogId:a})}},{key:"sendDeliveredStatus",value:function(e,t,a){y.a.chat.sendDeliveredStatus({messageId:e,userId:t,dialogId:a})}},{key:"getUsersList",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.users.get({per_page:100,filter:{field:"id",param:"in",value:t}});case 2:return a=e.sent,e.abrupt("return",a.items.map((function(e){return new oe(e.user)})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserFromServerById",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.a.users.get(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSelectDialog",value:function(e){ae.dispatch(function(e){return{type:P,dialog:e}}(e))}},{key:"getSelectedDialog",value:function(){return ae.getState().selectedDialog}},{key:"getDialogById",value:function(e){return ae.getState().dialogs.find((function(t){return t.id===e}))}},{key:"getMessagesByDialogId",value:function(e){return ae.getState().messages[e]}},{key:"uploadPhoto",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.a.storage.createAndUpload(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserFromReduxById",value:function(e){return ae.getState().users[e]}},{key:"currentUser",get:function(){return ae.getState().currentUser.user}},{key:"messageUniqueId",get:function(){return y.a.chat.helpers.getBsonObjectId()}}]),e}());Object.freeze(ue);var de=ue,he=(a(319),a(145)),me=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,[{key:"init",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.init.apply(y.a,Object(Y.a)(he.connectyCubeConfig));case 2:return e.abrupt("return",this.autologin());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"autologin",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserSession();case 2:if(!(t=e.sent)){e.next=10;break}return a=JSON.parse(t),e.next=7,this.signIn({login:a.login,password:a.password});case 7:return e.abrupt("return","home");case 10:return e.abrupt("return","auth");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signIn",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.createSession(t);case 2:a=e.sent,n=new oe(a.user),a.user.avatar=E(a.user.avatar),a.user.full_name=a.user.login,ae.dispatch(J(a)),r=Object.assign({},n,{password:t.password}),this.setUserSession(r),this.connect(r.id,r.password);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signUp",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.createSession();case 2:return e.next=4,y.a.users.signup(t);case 4:return e.abrupt("return",this.signIn(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.chat.connect({userId:t,password:a});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"setUserSession",value:function(t){return localStorage.setItem(e.CURRENT_USER_SESSION_KEY,JSON.stringify(t))}},{key:"getUserSession",value:function(){return localStorage.getItem(e.CURRENT_USER_SESSION_KEY)}},{key:"logout",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.clear(),e.next=3,y.a.logout();case 3:ae.dispatch({type:"RESSET_STORE"});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();me.CURRENT_USER_SESSION_KEY="CURRENT_USER_SESSION_KEY",me.DEVICE_TOKEN_KEY="DEVICE_TOKEN_KEY";var ge=new me;Object.freeze(ge);var pe=ge,fe=a.p+"static/media/logo_with_text.a95d1c0f.png",ve=a(27),ye=a.n(ve),Ee=(a(320),a(321),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"container-loader"},r.a.createElement("div",{className:"loader"}))}}]),a}(n.Component)),_e=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(u.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={isLogin:!0,isLoader:!1,full_name:"",login:"",password:"",isAuthorization:!1},e.handleStateModal=function(){return e.setState({isLogin:!e.state.isLogin})},e.changeName=function(t){return e.setState({full_name:t.target.value})},e.changeLogin=function(t){return e.setState({login:t.target.value})},e.changePassword=function(t){return e.setState({password:t.target.value})},e.login=function(t){t.preventDefault();var a=e.state,n=a.login,r=a.password,s=a.full_name,i=a.isLogin,o={login:n,password:r};if(n.trim()&&r.trim()&&(i||s.trim()))e.setState({isLoader:!0}),i?pe.signIn(o).then((function(){e.setState({isLoader:!1,isAuthorization:!0})})).catch((function(t){e.setState({isLoader:!1}),ye()("Error.\n\n".concat(JSON.stringify(t)),"","error")})):(o.full_name=s,pe.signUp(o).then((function(){e.setState({isLoader:!1,isAuthorization:!0}),ye()("Account successfully registered!","","success")})).catch((function(t){e.setState({isLoader:!1}),ye()("Error.\n\n".concat(JSON.stringify(t)),"","error")})));else{var c=i?"login.":"sign up";ye()("Warning","Fill the fields to ".concat(c))}},e}return Object(d.a)(a,[{key:"render",value:function(){var e=this.state,t=e.isLogin,a=e.login,n=e.password,s=e.isLoader,i=e.isAuthorization,o=e.full_name,c=t?"Don't have an account?":"Already have an account?",l=t?"Sign up":"Sign in";return r.a.createElement("div",{className:"auth-main-\u0441ontainer",style:this.props.isSmallDevice&&{backgroundColor:"#27ae60"}},r.a.createElement("div",{className:"auth-modal-container",style:t?{height:"500px"}:{height:"570px"}},s&&r.a.createElement("div",{className:"auth-wrapp-loader"},r.a.createElement(Ee,null)),i&&r.a.createElement(f.a,{to:"/home"}),r.a.createElement("div",{className:"auth-logo"},r.a.createElement("img",{src:fe,alt:"Logo"})),r.a.createElement("form",{onSubmit:this.login,className:"auth-form auth-wrapper"},!t&&r.a.createElement("input",{type:"text",value:o,onChange:this.changeName,required:!0,placeholder:"Name",name:"Name"}),r.a.createElement("input",{type:"text",value:a,onChange:this.changeLogin,required:!0,placeholder:"Login",name:"login"}),r.a.createElement("input",{type:"password",value:n,onChange:this.changePassword,required:!0,placeholder:"Password",name:"Password"}),r.a.createElement("button",{type:"submit",value:"Submit"},t?"Log in":"Sign up")),r.a.createElement("div",{className:"auth-footer"},r.a.createElement("span",null,c),r.a.createElement("a",{onClick:this.handleStateModal},l))))}}]),a}(n.Component),be=a(367),we=a(368),Se=a(11),Oe=a(4),ke=(a(323),a(49)),je=a.n(ke);a(333);function xe(e){var t=e.photo,a=e.name,n=e.size;return t?r.a.createElement("div",{style:{width:n,height:n}},r.a.createElement("div",{style:{width:n||"100%",height:n||"100%",borderRadius:"50%",backgroundImage:"url(".concat(t,")"),backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}})):r.a.createElement("div",{style:{width:n,height:n}},r.a.createElement("div",{className:"avatar-as-icon",style:{backgroundColor:function(){var e=["blue","darkmagenta","fuchsia","gold","green","limegreen","navy","purple","red","skyblue"];return e[a.length%e.length]}()}},r.a.createElement("p",{style:{fontSize:n/2.4}},function(){var e=a.split(" ");return e.length>1?"".concat(e[0].slice(0,1)).concat(e[1].slice(0,1)):a.slice(0,2)}().toUpperCase())))}var Ue=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).customStyles={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",transform:"translate(-50%, -50%)",border:"none",padding:0}},n.showMoreInformation=function(){n.setState({isModal:!n.state.isModal})},n.handleCloseModal=function(){return n.setState({isModal:!1})},n.logOut=function(){pe.logout()},n.settings=function(){alert("Coming soon"),n.handleCloseModal()},n.state={isModal:!1},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this.state.isModal,t=this.props.currentUser;if(!t)return r.a.createElement(r.a.Fragment,null);var a=t.user;return r.a.createElement("div",{className:"user-rofile-container"},r.a.createElement("div",{className:"user-profile-wrapper"},r.a.createElement("div",{className:"user-profile-user-info"},r.a.createElement("div",{className:"online"},r.a.createElement(xe,{photo:a.avatar,name:a.full_name,size:50})),r.a.createElement("span",null,a.full_name)),r.a.createElement("div",{className:"user-profile-icon",id:"user-profile-icon",onClick:this.showMoreInformation},e?r.a.createElement(Se.a,{icon:Oe.h,color:"white"}):r.a.createElement(Se.a,{icon:Oe.f,color:"#435f7a"}))),e&&r.a.createElement(r.a.Fragment,null,r.a.createElement(je.a,{isOpen:e,onRequestClose:this.handleCloseModal,ariaHideApp:!1,style:this.customStyles,overlayClassName:"Overlay-user-profile"}),r.a.createElement("div",{className:"user-profile-modal"},r.a.createElement("ul",null,r.a.createElement("li",{className:"user-profile-user-more-info"},r.a.createElement(p.b,{to:"/auth",onClick:this.logOut,className:"reset-user-profile"},"Logout")),r.a.createElement("li",{className:"user-profile-user-more-info"},r.a.createElement(p.b,{to:"/home",onClick:this.settings,className:"reset-user-profile"},"Settings"))))))}}]),a}(n.Component),Ce=Object(g.b)((function(e){return{currentUser:e.currentUser}}))(Ue),De=a(38),Ie=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"getDialogLayoutProvider",value:function(e){return new De.LayoutProvider((function(){return"type"}),(function(t,a){a.width=e,a.height=75}))}}]),e}(),Ne=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"getChatLayoutProvider",value:function(e){var t=e.width,a=e.dialogId,n=e.currentUserId,r=new Me(t);return new De.LayoutProvider((function(e){return e}),(function(e,s,i){if(ae.getState().messages[a][i].attachment)return s.width=t,void(s.height=300);var o;o=ae.getState().messages[a][i].sender_id===n?r.currentSender:r.otherSender;var c=document.createElement("canvas").getContext("2d");c.font="".concat(16,"px 'Open Sans', sans-serif");var l=ae.getState().messages[a][i].body,u=c.measureText(l).width,d=Math.ceil(u/(o-20));s.width=t,s.height=1.5*d*16+30+15}))}}]),e}(),Me=function e(t){Object(u.a)(this,e),t<550&&(this.currentSender=300,this.otherSender=250),t>550&&t<768&&(this.currentSender=420,this.otherSender=470),t>768&&t<960&&(this.currentSender=450,this.otherSender=500),t>960&&(this.currentSender=650,this.otherSender=600)};function Le(e){var t=e?new Date(1e3*e):new Date,a=t.getHours(),n=t.getMinutes();return"".concat(a>9?a:"0"+a,":").concat(n>9?n:"0"+n)}a(354);var Re=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).scrollWidth=0,n.scrollHeight=0,n.listenerWindowSize=null,n.timer=null,n.allDialog=[],n.handleResize=function(){n.scrollWidth=document.getElementById("dialog-info-container").clientWidth,n.scrollHeight=document.getElementById("dialog-info-container").clientHeight,n.timer||(n.timer=setTimeout((function(){clearTimeout(n.timer),n.timer=null,n.setState({isAlredy:!0,layoutProvider:Ie.getDialogLayoutProvider(n.scrollWidth)})}),500))},n.changeSearch=function(e){var t=[];""===e.target.value?t=n.allDialog:n.allDialog.forEach((function(a){a.name.toUpperCase().includes(e.target.value.toUpperCase())&&t.push(a)})),n.setState({search:e.target.value,dataProvider:n.state.dataProvider.cloneWithRows(t)})},n.goToChat=function(e){var t=n.props.router;de.setSelectDialog(e),t("/home/chat")},n.createNewDialog=function(){(0,n.props.router)("/home/create-dialog")},n._renderDialog=function(e,t){return r.a.createElement("li",{onClick:function(){return n.goToChat(t)}},r.a.createElement("div",{className:"dialog-wrap-avatar"},r.a.createElement(xe,{photo:t.photo,name:t.name,size:50})),r.a.createElement("div",{className:"dialog-wrap-block"},r.a.createElement("div",{className:"dialog-wrap-block-left"},r.a.createElement("h5",null,t.name),r.a.createElement("span",null,""===t.last_message?"No messages yet":t.last_message)),r.a.createElement("div",{className:"dialog-wrap-block-right"},r.a.createElement("p",null,function(e){var t=e.lastDate,a=e.lastMessage,n=e.updatedDate,r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=a?new Date(1e3*t):new Date(n),i=s.getFullYear(),o=s.getMonth(),c=s.getDate(),l=s.getDay(),u=s.getHours(),d=s.getMinutes(),h=new Date,m=h.getFullYear(),g=h.getMonth(),p=h.getDate(),f=h.getDay();return m>i?"".concat(r[o]," ").concat(c,", ").concat(i):g>o||p>c+6?"".concat(r[o]," ").concat(c):f>l?"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][l]):"".concat(u>9?u:"0"+u,":").concat(d>9?d:"0"+d)}({lastDate:t.last_message_date_sent,lastMessage:t.last_message,updatedDate:t.updated_date})),t.unread_messages_count>0&&r.a.createElement("span",null,t.unread_messages_count))))},n.state={isAlredy:!1,dataProvider:new De.DataProvider((function(e,t){return e!==t||e.unread_messages_count!==t.unread_messages_count})),layoutProvider:0,count:20,isLoader:!0,search:""},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleResize),this.scrollWidth=document.getElementById("dialog-info-container").clientWidth,this.scrollHeight=document.getElementById("dialog-info-container").clientHeight,de.fetchDialogsFromServer().then((function(t){e.allDialog=t,e.setState({isAlredy:!0,isLoader:!1,layoutProvider:Ie.getDialogLayoutProvider(e.scrollWidth),dataProvider:e.state.dataProvider.cloneWithRows(t)})}))}},{key:"componentDidUpdate",value:function(e){var t=this.props.dialogs;this.props.dialogs!==e.dialogs&&(this.allDialog=t,this.setState({layoutProvider:Ie.getDialogLayoutProvider(this.scrollWidth),dataProvider:this.state.dataProvider.cloneWithRows(t)}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this.state,t=e.isLoader,a=e.dataProvider,n=e.layoutProvider,s=e.search;return r.a.createElement("div",{className:"dialog-container"},r.a.createElement("button",{onClick:this.createNewDialog},r.a.createElement(Se.a,{icon:Oe.p,color:"#d2d2d2"}),r.a.createElement("span",null,"New chat")),r.a.createElement("div",{className:"dialog-input-search"},r.a.createElement("div",{className:"dialog-input-search-icon"},r.a.createElement(Se.a,{icon:Oe.m,color:"#d2d2d2"})),r.a.createElement("input",{className:"input-field",type:"text",value:s,onChange:this.changeSearch,required:!0,placeholder:"Search chats...",name:"search"})),r.a.createElement("div",{className:"dialog-info-container",id:"dialog-info-container"},t?r.a.createElement("div",{style:{position:"absolute",width:"100%",height:"100%"}},r.a.createElement(Ee,null)):0===a.length?r.a.createElement("div",{className:"dialog-no-chats"},r.a.createElement("h3",null,"No chats yet")):this.state.isAlredy?a._data.length>0?r.a.createElement("ul",null,r.a.createElement(De.RecyclerListView,{style:{width:this.scrollWidth,height:this.scrollHeight},dataProvider:a,layoutProvider:n,rowRenderer:this._renderDialog})):r.a.createElement("div",{className:"dialog-no-chats"},r.a.createElement("h3",null,"No results")):null))}}]),a}(n.Component),Ae=Object(g.b)((function(e){return{dialogs:e.dialogs}}))(Re),Pe=(a(355),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){var e=this.props.router;return r.a.createElement("div",{className:"sidebar-container"},r.a.createElement(Ce,null),r.a.createElement(Ae,{router:e}))}}]),a}(n.Component)),Te=a(149),Fe=function(e){return new Promise((function(t,a){var n=new Image;n.addEventListener("load",(function(){return t(n)})),n.addEventListener("error",(function(e){return a(e)})),n.setAttribute("crossOrigin","anonymous"),n.src=e}))};function ze(e){return e*Math.PI/180}function We(e,t){return Be.apply(this,arguments)}function Be(){return(Be=Object(l.a)(c.a.mark((function e(t,a){var n,r,s,i,o,l,u,d=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>2&&void 0!==d[2]?d[2]:0,e.next=3,Fe(t);case 3:return r=e.sent,s=document.createElement("canvas"),i=s.getContext("2d"),o=Math.max(r.width,r.height),l=o/2*Math.sqrt(2)*2,s.width=l,s.height=l,i.translate(l/2,l/2),i.rotate(ze(n)),i.translate(-l/2,-l/2),i.drawImage(r,l/2-.5*r.width,l/2-.5*r.height),u=i.getImageData(0,0,l,l),s.width=400,s.height=400,i.putImageData(u,0-l/2+.5*r.width-a.x,0-l/2+.5*r.height-a.y),e.abrupt("return",new Promise((function(e){s.toBlob((function(t){var a=new File([t],"filename.jpg",{type:"image/jpeg"}),n={file:{size:t.size,type:t.type,file:a,name:"samo-name.jpg",public:!1},link:{url:URL.createObjectURL(t)}};e(n)}),"image/jpeg")})));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(356);var He={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",transform:"translate(-50%, -50%)",border:"none",padding:0,boxShadow:"2px 2px 25px 0px black"}},Ge=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).croppedAreaPixels=null,n.cropedImage=null,n.onCropChange=function(e){n.setState({crop:e})},n.onCropComplete=function(e,t){n.croppedAreaPixels=t},n.cropImage=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(n.state.imageSrc,n.croppedAreaPixels);case 2:n.cropedImage=e.sent,n.props.getImage(n.cropedImage.file),n.handleCloseModal();case 5:case"end":return e.stop()}}),e)}))),n.onZoomChange=function(e){n.setState({zoom:e})},n.handleCloseModal=function(){return n.setState({isModal:!1})},n.handleOpenModal=function(){return n.setState({isModal:!0})},n.onImageChange=function(e){e.target.files&&e.target.files[0]&&n.setState({imageSrc:URL.createObjectURL(e.target.files[0]),isModal:!0})},n._renderAvatarPicker=function(){var e;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"image-picker"},r.a.createElement("label",{htmlFor:"file-upload",className:"custom-file-upload"},n.cropedImage?r.a.createElement("img",{src:null===(e=n.cropedImage)||void 0===e?void 0:e.link.url,alt:"groupPhoto",style:{width:60,height:60,borderRadius:"50%"}}):r.a.createElement(Se.a,{icon:Oe.b,color:"black"})),r.a.createElement("input",{id:"file-upload",type:"file",onChange:n.onImageChange})))},n._renderAttachmentPicker=function(){return r.a.createElement("div",{className:"image-picker-container"},r.a.createElement("label",{htmlFor:"file-upload",className:"custom-file-upload-attachment"},r.a.createElement(Se.a,{icon:Oe.l,color:"#9aa8b5"})),r.a.createElement("input",{id:"file-upload",type:"file",onChange:n.onImageChange}))},n.state={image:"",imageSrc:"",crop:{x:0,y:0},zoom:1,isModal:!1},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this.props.pickAsAttachment,t=this.state.isModal;return r.a.createElement(r.a.Fragment,null,e?this._renderAttachmentPicker():this._renderAvatarPicker(),r.a.createElement(je.a,{isOpen:t,onRequestClose:this.handleCloseModal,ariaHideApp:!1,style:He,overlayClassName:"Overlay"},r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"image-crop-picker-header"},r.a.createElement("button",{onClick:this.cropImage},"Next"),r.a.createElement("button",{onClick:this.handleCloseModal},"Cancel")),r.a.createElement("div",{className:"image-crop-picker-container"},r.a.createElement(Te.a,{image:this.state.imageSrc,crop:this.state.crop,zoom:this.state.zoom,cropSize:{width:300,height:300},onCropChange:this.onCropChange,onCropComplete:this.onCropComplete,onZoomChange:this.onZoomChange})))))}}]),a}(n.Component),qe=(a(357),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(u.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={messageText:""},e.changeMessage=function(t){return e.setState({messageText:t.target.value})},e.sendMessage=function(t){t.preventDefault(),e.props.sendMessageCallback(e.state.messageText).then((function(){return e.setState({messageText:""})})).catch((function(){return e.setState({messageText:""})}))},e.getImage=function(t){e.props.sendMessageCallback(e.state.messageText,t).then((function(){return e.setState({messageText:""})})).catch((function(){return e.setState({messageText:""})}))},e}return Object(d.a)(a,[{key:"render",value:function(){var e=this.state.messageText;return r.a.createElement("footer",null,r.a.createElement("form",{onSubmit:this.sendMessage},r.a.createElement("input",{type:"text",value:e,onChange:this.changeMessage,placeholder:"Write your message...",name:"search"}),r.a.createElement("div",{className:"chat-attachment"},r.a.createElement(Ge,{pickAsAttachment:!0,getImage:this.getImage})),r.a.createElement("button",{onClick:this.sendMessage},r.a.createElement(Se.a,{icon:Oe.k,color:"white"}))))}}]),a}(n.PureComponent)),Je=new(function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,[{key:"getUserById",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.a.users.get(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOccupants",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.getUsers,n=this.currentUser,r=[],t.forEach((function(e){e===n.id||a[e]||140===e||r.push(e)})),0!==r.length){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,y.a.users.get({per_page:100,filter:{field:"id",param:"in",value:r}});case 8:s=e.sent,i=s.items.map((function(e){return new oe(e.user)})),ae.dispatch(z(i));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUsersAvatar",value:function(e){var t=this.currentUser,a=null;return e.forEach((function(e){e!==t.id&&(a=e)})),ae.getState().users[a].avatar}},{key:"listUsersByFullName",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,r,s=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=s.length>1&&void 0!==s[1]?s[1]:[])||(a=[this.currentUser.id]),e.next=4,y.a.users.get({per_page:100,full_name:t});case 4:return n=e.sent,r=[],n.items.forEach((function(e){a.includes(e.user.id)||r.push(new oe(e.user))})),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"currentUser",get:function(){return ae.getState().currentUser.user}},{key:"getUsers",get:function(){return ae.getState().users}}]),e}());Object.freeze(Je);var Ye=Je;function Ke(e){switch(e.send_state){case 0:return r.a.createElement(Se.a,{icon:Oe.i,color:"grey"});case 1:return r.a.createElement(Se.a,{icon:Oe.c,color:"grey"});case 2:return r.a.createElement(Se.a,{icon:Oe.e,color:"grey"});case 3:return r.a.createElement(Se.a,{icon:Oe.e,color:"#27ae60"});default:return r.a.createElement(Se.a,{icon:Oe.i,color:"white"})}}a(358);var Ze=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).selectedImg=null,n.customStyles={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",transform:"translate(-50%, -50%)",border:"none",padding:0}},n._renderAsStr=function(e){var t=n.props.message;return 1===e?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{wordWrap:"break-word"}},t.body),r.a.createElement("div",{className:"chat-message-right-footer"},r.a.createElement("span",null,r.a.createElement(r.a.Fragment,null,Le(t.date_sent)),r.a.createElement(r.a.Fragment,null,r.a.createElement(Ke,{send_state:t.send_state}))))):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{wordWrap:"break-word"}},t.body),r.a.createElement("div",{className:"chat-message-left-footer"},r.a.createElement("span",null,Le(t.date_sent))))},n.renderZoomImg=function(e,t){e.preventDefault(),n.selectedImg=t.attachment[0],n.setState({isModal:!0})},n.handleCloseModal=function(){return n.setState({isModal:!1})},n._renderAsAttachment=function(){var e=n.props,t=e.message,a=e.whoIsSender;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"chat-message-container-attachment"},r.a.createElement("div",{style:{backgroundImage:"url(".concat(t.attachment[0].url,")"),backgroundPosition:"center",width:"100%",height:"100%",border:"1px solid #cbcbcb",cursor:"pointer"},onClick:function(e){return n.renderZoomImg(e,t)}})),1===a?r.a.createElement("div",{className:"chat-message-right-footer"},r.a.createElement("span",null,r.a.createElement(r.a.Fragment,null,Le(t.date_sent)),r.a.createElement(r.a.Fragment,null,r.a.createElement(Ke,{send_state:t.send_state})))):r.a.createElement("div",{className:"chat-message-left-footer"},r.a.createElement("span",null,Le(t.date_sent))))},n.state={isModal:!1},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this.props,t=e.message,a=e.whoIsSender,n=e.participantInfo,s=e.notRenderAvatar,i=e.widthScroll,o=this.state.isModal,c=new Me(i);return r.a.createElement(r.a.Fragment,null,o&&r.a.createElement(je.a,{isOpen:o,onRequestClose:this.handleCloseModal,ariaHideApp:!1,style:this.customStyles,overlayClassName:"overlay-chat-attachment"},r.a.createElement("div",{className:"active-window-modal-attachment"},r.a.createElement(Se.a,{icon:Oe.n,color:"white",onClick:this.handleCloseModal}),r.a.createElement("img",{src:this.selectedImg.url,width:this.selectedImg.width,height:this.selectedImg.height,alt:"zoomImg"}))),r.a.createElement("div",{className:"chat-message-layout"},1===a?r.a.createElement("div",{className:"chat-message-wrap chat-message-wrap-right"},r.a.createElement("div",{style:{maxWidth:"".concat(c.currentSender,"px")},className:"chat-message-container-position-right"},t.attachment?this._renderAsAttachment(1):this._renderAsStr(1))):r.a.createElement("div",{className:"chat-message-wrap chat-message-wrap-left"},r.a.createElement("div",{className:"chat-message-avatar"},s&&r.a.createElement(xe,{photo:n.avatar,name:n.name||n.full_name,size:30})),r.a.createElement("div",{style:{maxWidth:"".concat(t.attachment?c.otherSender+60:c.otherSender,"px")},className:"chat-message-container-position-left"},t.attachment?this._renderAsAttachment(2):this._renderAsStr(2)))))}}]),a}(n.Component),Ve=(a(359),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).scrollWidth=0,n.scrollHeight=0,n.listenerWindowSize=null,n.timer=null,n.isFetchingMsg=!1,n.messagesListRef=null,n.listenerLazyLoad=!1,n.needToGetMoreMessage=null,n.recycler_Y=0,n.contentHeight=0,n.contentNewOffset=0,n.lazyLoadMessages=function(e,t){n.recycler_Y=t,n.contentHeight=e.nativeEvent.contentSize.height,n.listenerLazyLoad&&n.needToGetMoreMessage&&t<2e3&&(n.listenerLazyLoad=!1,de.getMoreMessages(n.props.selectedDialog).then((function(e){n.needToGetMoreMessage=100===e,n.listenerLazyLoad=!0})))},n.getDialogInfo=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=de.getDialogById(n.props.selectedDialog.id),e.next=3,Ye.getOccupants(t.occupants_ids);case 3:de.getMessages(t).catch((function(e){return alert("Error.\n\n".concat(JSON.stringify(e)))})).then((function(e){n.needToGetMoreMessage=100===e,n.setState({isFetchingMsg:!0,layoutProvider:Ne.getChatLayoutProvider({width:n.scrollWidth,dialogId:t.id,currentUserId:n.currentUserInfo.id}),dataProvider:n.state.dataProvider.cloneWithRows(n.props.messages[t.id])}),n.scrollToBottom(),n.listenerLazyLoad=!0}));case 4:case"end":return e.stop()}}),e)}))),n.updateScrollPosition=function(){setTimeout((function(){var e=document.getElementById("chat-body").children[0].children[0].children[0].style.height,t=e.slice(0,e.length-2),a=n.recycler_Y+(t-n.contentHeight);n.messagesListRef.scrollToOffset(0,a)}),100)},n.handleResize=function(){if(n.scrollWidth=document.getElementById("chat-body").clientWidth,n.scrollHeight=document.getElementById("chat-body").clientHeight,!n.timer){var e=de.getDialogById(n.props.selectedDialog.id);n.timer=setTimeout((function(){clearTimeout(n.timer),n.timer=null,n.setState({isAlredy:!0,layoutProvider:Ne.getChatLayoutProvider({width:n.scrollWidth,dialogId:e.id,currentUserId:n.currentUserInfo.id})})}),500)}},n.sendMessageCallback=function(){var e=Object(l.a)(c.a.mark((function e(t,a){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=de.getDialogById(n.props.selectedDialog.id),!(t.length<=0)||a){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,de.sendMessage(r,t,a,n.scrollToBottom);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),n.goToSplashPage=function(){(0,n.props.router)("/home")},n._renderMessage=function(e,t){var a=n.props.users,s=n.currentUserInfo.id===t.sender_id?1:2,i=2===s?a[t.sender_id]:null,o=null;return e>0&&1!==s&&+n.state.dataProvider._data[e-1].sender_id!==+t.sender_id&&(o=!0),r.a.createElement(Ze,{whoIsSender:s,message:t,participantInfo:i,notRenderAvatar:o,widthScroll:n.scrollWidth})},n.getDialogById=function(){return de.getDialogById(n.props.selectedDialog.id)},n.scrollToBottom=function(){n.messagesListRef&&n.messagesListRef.scrollToIndex(n.state.dataProvider._data.length-1,!1)},n.state={isAlredy:!0,dataProvider:new De.DataProvider((function(e,t){return e!==t||e.send_state!==t.send_state})),layoutProvider:[]},n.currentUserInfo=ae.getState().currentUser.user,n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),this.scrollWidth=document.getElementById("chat-body").clientWidth,this.scrollHeight=document.getElementById("chat-body").clientHeight,this.getDialogInfo()}},{key:"componentDidUpdate",value:function(e){var t=this,a=de.getDialogById(this.props.selectedDialog.id);e.messages[a.id]&&e.messages[a.id]!==this.props.messages[a.id]&&(console.log("{chat} prew props",e.messages[a.id]),console.log("{chat} this props",this.props.messages[a.id]),this.props.messages[a.id].length&&this.setState({dataProvider:this.state.dataProvider.cloneWithRows(this.props.messages[a.id])},(function(){t.updateScrollPosition()})))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e,t=this,a=this.state,n=a.dataProvider,s=a.layoutProvider,i=a.isAlredy,o=a.isFetchingMsg;return this.props.selectedDialog&&(e=this.getDialogById()),r.a.createElement("div",{className:"chat-container"},r.a.createElement("header",null,window.innerWidth<768&&r.a.createElement("button",{onClick:this.goToSplashPage},r.a.createElement(Se.a,{icon:Oe.g,color:"#212529"}),"Back"),r.a.createElement(xe,{photo:e.photo,name:e.name,size:50}),r.a.createElement("h3",null,e.name)),r.a.createElement("div",{className:"chat-body",id:"chat-body"},i&&o?n._data.length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement(De.RecyclerListView,{style:{width:this.scrollWidth,height:this.scrollHeight},ref:function(e){return t.messagesListRef=e},dataProvider:n,layoutProvider:s,rowRenderer:this._renderMessage,onScroll:function(e,a,n){t.lazyLoadMessages(e,n)}})):r.a.createElement(Ee,null)),r.a.createElement(qe,{sendMessageCallback:this.sendMessageCallback}))}}]),a}(n.PureComponent)),Qe=Object(g.b)((function(e){return{selectedDialog:e.selectedDialog,messages:e.messages,users:e.users}}))(Ve);a(360);function Xe(){return r.a.createElement("div",{className:"splash-page-container"},r.a.createElement("p",null,"Please select a chat to start messaging"))}a(361);function $e(e){var t=e.router;return r.a.createElement("div",{className:"create-dialog-header"},r.a.createElement("button",{onClick:function(){t("/home/")}},r.a.createElement(Se.a,{icon:Oe.g,color:"black"}),r.a.createElement("span",null,"Back")))}a(362);var et=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(u.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={isSelectedUser:!1},e}return Object(d.a)(a,[{key:"toggleUserSelect",value:function(){var e=this.props;(0,e.selectUsers)(e.user)}},{key:"componentDidUpdate",value:function(e){e.selectedUsers!==this.props.selectedUsers&&this.setState({isSelectedUser:this.props.selectedUsers})}},{key:"render",value:function(){var e=this,t=this.props,a=t.user,n=t.selectedUsers,s=t.dialogType,i=this.state.isSelectedUser;return r.a.createElement("div",{className:"render-search-user",onClick:function(){return e.toggleUserSelect()}},r.a.createElement("div",{className:"render-search-user-info"},r.a.createElement(xe,{photo:a.avatar,name:a.full_name,size:40}),r.a.createElement("span",null,a.full_name)),s?i||n?r.a.createElement(Se.a,{icon:Oe.d,color:"green"}):r.a.createElement(Se.a,{icon:Oe.j,color:"black"}):r.a.createElement(Se.a,{icon:Oe.a,color:"green"}))}}]),a}(n.PureComponent),tt=(a(363),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).listUsers=[],n.userNotFound=!1,n.selectedUsers=[],n.isGroupDetails=!1,n.image=null,n.toggleUserSelect=function(e){var t=[];n.selectedUsers.forEach((function(a){a.id!==e.id&&t.push(a)})),n.selectedUsers=t,n.setState({isUpdate:!n.state.isUpdate})},n.getImage=function(e){n.image=e},n.createDialog=function(){var e=n.state.dialogName.trim(),t=n.props.router;if(e.length<3)return ye()("Warning","Enter more than 4 characters for group subject");n.setState({isLoader:!0});var a=n.selectedUsers.map((function(e){return e.id}));de.createPublicDialog(a,e,n.image).then((function(e){n.setState({isLoader:!1}),de.setSelectDialog(e),de.sendChatAlertOnCreate(e),t("/home/chat")})).catch((function(e){n.setState({isLoader:!1}),ye()("Error",e)}))},n.searchUsers=function(e){e.preventDefault();var t=n.state.keyword.trim();t.length>2?(n.setState({isLoader:!0}),Ye.listUsersByFullName(t).then((function(e){n.listUsers=e,n.userNotFound=!1,n.setState({isLoader:!1})})).catch((function(){n.userNotFound=!0,n.setState({isLoader:!1})}))):ye()("Warning","Enter more than 3 characters")},n.changeTypeDialog=function(){n.selectedUsers=[],n.setState({dialogType:!n.state.dialogType})},n.selectUsers=function(e){var t=n.props.router;if(!n.state.dialogType)return de.createPrivateDialog(e.id).then((function(e){de.setSelectDialog(e),de.sendChatAlertOnCreate(e),t("/home/chat")})).catch((function(e){n.setState({isLoader:!1}),ye()("Error",e)}));if(n.selectedUsers.find((function(t){return t.id===e.id}))){var a=[];n.selectedUsers.forEach((function(t){t.id!==e.id&&a.push(t)})),n.selectedUsers=a}else{if(9===n.selectedUsers.length)return void ye()("Warning","Maximum 9 participants");n.selectedUsers.push(e)}n.setState({isUpdate:!n.state.isUpdate})},n._renderUser=function(e){var t=n.selectedUsers.find((function(t){return t.id===e.id}));return r.a.createElement(et,{user:e,selectUsers:n.selectUsers,dialogType:n.state.dialogType,selectedUsers:!!t,key:e.id})},n.changeSearch=function(e){return n.setState({keyword:e.target.value})},n.changeDialogName=function(e){return n.setState({dialogName:e.target.value})},n._renderSelectedUsers=function(e){return r.a.createElement("button",{key:e.id,className:"create-dialog-body-selected-avatar",onClick:function(){return n.toggleUserSelect(e)}},r.a.createElement(xe,{photo:e.avatar,name:e.full_name,size:40}),r.a.createElement(Se.a,{icon:Oe.n,color:"grey"}))},n.state={keyword:"",isLoader:!1,dialogType:!1,dialogName:"",isUpdate:!1},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this,t=this.props.router,a=this.state,n=a.keyword,s=a.dialogType,i=a.isLoader,o=a.dialogName,c=window.innerWidth<768?0:50,l=s?470-c:390-c;return r.a.createElement("div",{className:"create-dialog-container"},window.innerWidth<768&&r.a.createElement($e,{router:t}),i&&r.a.createElement("div",{style:{position:"absolute",width:"100%",height:"100%"}},r.a.createElement(Ee,null)),r.a.createElement("div",{className:"create-dialog-body"},r.a.createElement("div",{className:"create-dialog-body-groupinfo"},r.a.createElement(Ge,{getImage:this.getImage}),r.a.createElement("input",{type:"text",placeholder:"Group Subject",value:o,onChange:this.changeDialogName})),r.a.createElement("form",{className:"create-dialog-body-search",onSubmit:this.searchUsers},r.a.createElement("input",{type:"text",value:n,onChange:this.changeSearch,required:!0,placeholder:"Type contact name",name:"search"}),r.a.createElement("button",{onClick:this.searchUsers},r.a.createElement(Se.a,{icon:Oe.m,color:"white"}))),r.a.createElement("div",{className:"create-dialog-body-type-dialog"},r.a.createElement("button",{onClick:this.changeTypeDialog},s?r.a.createElement(Se.a,{icon:Oe.q,color:"#27ae60"}):r.a.createElement(Se.a,{icon:Oe.o,color:"#27ae60"}),r.a.createElement("span",null,s?"Create private chat":"Create group chat"))),s&&this.selectedUsers.length>0&&r.a.createElement("div",{className:"create-dialog-body-selected-users"},this.selectedUsers.map((function(t){return e._renderSelectedUsers(t)}))),this.userNotFound?r.a.createElement("h5",null,"Couldn't find user"):r.a.createElement("div",{className:"create-dialog-body-users",style:{height:"calc(100vh - ".concat(l,"px)")}},this.listUsers.map((function(t){return e._renderUser(t)}))),this.selectedUsers.length>0&&r.a.createElement("div",{className:"create-dialog-body-btn"},r.a.createElement("button",{onClick:this.createDialog},"Create grup"))))}}]),a}(n.PureComponent)),at=(a(364),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).changeRouter=function(e){n.setState({routerUrl:e})},n.state={routName:!1,routerUrl:e.match.url},e.history.replace("/home"),n.windowWidth=window.innerWidth,n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){de.setUpListeners()}},{key:"render",value:function(){var e=this,t=this.state.routerUrl,a=this.props.match;return r.a.createElement("div",{className:"home-frame"},r.a.createElement("div",{className:"home-active-container"},this.windowWidth>=768?r.a.createElement(be.a,{className:"default-row"},r.a.createElement(we.a,{sm:12,md:5,lg:5,xl:3,className:"default-grid"},r.a.createElement(Pe,{router:this.changeRouter})),r.a.createElement(we.a,{sm:12,md:7,lg:7,xl:9,className:"default-grid"},r.a.createElement(p.a,null,r.a.createElement(f.b,{exact:!0,path:"".concat(a.url),component:Xe}),r.a.createElement(f.b,{path:"".concat(a.url,"/create-dialog"),component:function(){return r.a.createElement(tt,{router:e.changeRouter})}}),r.a.createElement(f.b,{path:"".concat(a.url,"/chat"),component:function(){return r.a.createElement(Qe,{router:e.changeRouter})}}),r.a.createElement(f.a,{to:t})))):r.a.createElement(be.a,null,r.a.createElement(we.a,{sm:12,md:5,lg:5,xl:3,className:"default-grid"},r.a.createElement(p.a,null,r.a.createElement(f.b,{exact:!0,path:"".concat(a.url),component:function(){return r.a.createElement(Pe,{router:e.changeRouter})}}),r.a.createElement(f.b,{path:"".concat(a.url,"/create-dialog"),component:function(){return r.a.createElement(tt,{router:e.changeRouter})}}),r.a.createElement(f.b,{path:"".concat(a.url,"/chat"),component:function(){return r.a.createElement(Qe,{router:e.changeRouter})}}),r.a.createElement(f.b,{path:"/auth",component:function(){return r.a.createElement(_e,{isSmallDevice:!0})}}),r.a.createElement(f.a,{to:t}))))))}}]),a}(n.Component)),nt=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).initUser=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe.init();case 2:t=e.sent,n.setState({routName:t,isLoader:!1});case 4:case"end":return e.stop()}}),e)}))),n.state={routName:!1,isLoader:!0},n.initUser(),n}return Object(d.a)(a,[{key:"render",value:function(){var e=this.state,t=e.routName,a=e.isLoader;return r.a.createElement(p.a,null,r.a.createElement(g.a,{store:ae},a?r.a.createElement("div",{style:{position:"absolute",width:"100%",height:"100%"}},r.a.createElement(Ee,null)):r.a.createElement(r.a.Fragment,null,r.a.createElement(f.b,{path:"/home",component:at}),r.a.createElement(f.b,{path:"/auth",component:_e}),r.a.createElement(f.a,{to:t}))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(nt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[365,1,2]]]);
//# sourceMappingURL=main.fe3c0460.chunk.js.map